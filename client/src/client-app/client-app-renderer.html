<link rel="import" href="client-app-datastore.html">

<script>
  const Renderer = (function () {
    return {
      geometricReference( position) {
        var run = true;

        //Currently since Camera is set on (0,0), the top right starts at (-300,-200)
        const minX = geometricMinX();
        const minY = geometricMinY();
        const scale = geometricScaler();

        var posX = position.x;
        var posY = position.y;

        var r = 0;
        var c = 0;
        while( posX > minX) {
          posX -= scale;
          r++;
        }
        while( posY > minY) {
          posY -= scale;
          c++;
        }

        //returns a record with the row and collumn its in
        return new Schema.GeoLocation({
          row: r,
          column: c
        });
      }, // geometricReference

      convertMatrixToCoordinates( meshCoord) {
        const sceneX = (0.5 + meshCoord.col) * Renderer.geometricScaler() + Renderer.geometricMinX();
        const sceneY = (0.5 + meshCoord.row) * Renderer.geometricScaler() + Renderer.geometricMinY();
        return new Schema.Position({ x: sceneX, y: sceneY });
      },

      //Use to scale geometric back to x and y
      //Currently 16 by 12 squares, each square is 50 pixels
      geometricScaler() {
        return 50;
      },

      geometricMinX() {
        return -300;
      },

      geometricMinY() {
        return -200;
      },
      //Create function called isLand?

      //If we are sending the wind object itself, change so it accepts that wind, and then changes the sprite it is associated with
      //Send wind coordiantes, then get the wind drawn in the geocordinates by a draw windsprite function

      drawWindSprite( scene, meshCoord, windStrength, rotWind) {
        var windSpriteType = 0;
        if (windStrength == 1) {
          windSpriteType = 1;
        } else if (windStrength == 2) {
          windSpriteType = 2;
        } else if (windStrength == 3) {
          windSpriteType = 3;
        }

        //This only works assuming position is a matrix like geolocation, otherwise add geolocation value
        //(phaserGame.windSpriteWidth / 2)
        //  + (phaserGame.windSpriteHeight / 2)
        const windSpriteDraw = Renderer.convertMatrixToCoordinates( meshCoord);

        //Does this really get a point? No it gets the top corner of a point

        //var test = phaserGame.windSpriteWidth;

        const wind = scene.add.sprite( windSpriteDraw.x, windSpriteDraw.y, 'wind', windSpriteType); //Not sure this is correct

        //rotWind
        wind.setAngle( rotWind); //Not sure if this works or not
      } // drawWindSprite      
    };
  })();
</script>      